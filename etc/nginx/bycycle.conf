server {
    listen 80;
    server_name bycycle.org;

    # Redirect to info site
    rewrite ^/(about|blog|category|contact|feed|projects|routefinder|support|trip-planner|tripplanner)(.*) http://info.bycycle.org/$1/$2 last;
    rewrite ^/200([\d])(.*) http://info.bycycle.org/200$1$2 last;

    # Fix ;find
    rewrite "^/regions/([^/]+)/services;find(.*)" http://bycycle.org/find$2?region=$1 last;
    rewrite "^/regions/([^/]+)/(geocode|route)s;find(.*)" http://bycycle.org/$2/find$3?region=$1 last;

    rewrite ^/regions/([^/]+)/services.* http://bycycle.org/find?region=$1 last;
    rewrite ^/regions/([^/]+)/(geocode|route)s.* http://bycycle.org/$1/find?region=$2 last;
    if ($args) {
        rewrite ^/regions/([^/]+) http://bycycle.org/find?region=$1 last;
    }
    rewrite ^/regions/([^/]+) http://bycycle.org/?region=$1 last;

    location / {
        uwsgi_pass unix:///home/deploy/var/run/uwsgi/bycycle.sock;
        include /home/deploy/etc/nginx/uwsgi_params;
        uwsgi_param SCRIPT_NAME "";
    }

    location /favicon.ico {
        alias /home/deploy/apps/bycycle/static/favicon.ico;
    }

    location /robots.txt {
        alias /home/deploy/apps/bycycle/static/robots.txt;
    }

    location /static/ {
        alias /home/deploy/apps/bycycle/static/;
    }
}
