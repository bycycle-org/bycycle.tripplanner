---
extends: "bycycle.core:commands.yaml"

globals:
  package: "bycycle.webapi"
  settings_file: "{{ env }}.ini"

envs:
  development:
    osm:
      bbox: [-122.7248, 45.4975, -122.6190, 45.5537]
      data_path: "osm.data"
  production:
    db:
      user: "bycycle"
      password: "bycycle"
      host: "localhost"
      port: 5432
      database: "bycycle"
    domain_name: "bycycle.org"
    deploy_user: "bycycle"
    deploy_root: "/sites/{{ domain_name }}"
    osm:
      bbox: [-122.836692, 45.4975, -122.472427, 45.650521]
      data_path: "{{ deploy_root }}/osm.data"

args:
  remote:
    run_as: "{{ deploy_user }}"
    host: "{{ domain_name }}"

  provision:
    env: "production"

  deploy:
    env: "production"

  push_nginx_config:
    host: "{{ remote.host }}"

  push_uwsgi_config:
    host: "{{ remote.host }}"
    config_file: "/etc/uwsgi/apps-available/{{ domain_name }}.ini"
    config_link: "/etc/uwsgi/apps-enabled/{{ domain_name }}.ini"

  fetch_osm_data:
    path: "{{ osm.data_path }}"
    bbox: "{{ osm.bbox }}"

  load_osm_data:
    path: "{{ osm.data_path }}"
