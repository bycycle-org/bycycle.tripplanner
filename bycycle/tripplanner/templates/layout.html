% if not wrap:
  ${self.body()}
% else:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  ${h.if_ie('<xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"/>')}


  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />

    <meta name="author" content="Wyatt Baldwin, wyatt@byCycle.org" />

    <meta name="keywords" content="bicycle, bike, bicycle trip planner, bicycle route finder, bike trip planner, bike route finder, bicycle route, bicycle trip, bike route, bike trip, bicycle routing, bike routing, maps, bicycle maps, bike maps, bicycle advocacy, community, sustainability, portland, oregon" />

    <meta name="description" content="byCycle.org Bicycle Trip Planner -- A web-based, interactive, bicycle trip planner (route finder) for the Portland, Oregon metro region." />

    <title>byCycle.org - Bicycle Trip Planner - ${self.title()}</title>

    ${request.stylesheet_link_tag('base', 'fixed-pane')}
    ${h.if_ie(request.stylesheet_link_tag('base_ie'))}
    ${request.stylesheet_link_tag('print', media='print')}
    ${self.stylesheet_links()}

    <script type="text/javascript">
      //<![CDATA[
      // Global setup
      var debug = ${str(debug).lower()};
      byCycle_prefix = '${request.script_name or "/"}';
      byCycle_staticPrefix = '${request.static_path("bycycle.tripplanner:static/")}';
      //]]>
    </script>

    ${request.javascript_include_tag('prototype')}
    ${request.javascript_include_tag('bycycle', 'util')}
  </head>


  <body>


    <div id="wrapper">


      <!-- Masthead -->
      <div id="masthead" class="noprint">
        <h1 id="logo">
          <a href="${request.application_url}" title="byCycle.org Home Page">
            ${h.image(request.static_url('bycycle.tripplanner:static/images/logo.png'), title='byCycle.org Home Page', width=141, height=23, alt='byCycle.org')}
          </a>
        </h1>

        <h2 id="app-name">
          ${h.link_to('Bicycle Trip Planner', request.application_url, title='byCycle.org Bicycle Trip Planner (this page)')}
        </h2>

        <h3 id="app-version">
          <a href="http://en.wikipedia.org/wiki/Development_stage#Beta"
             title="Beta? (opens in new window)"
             target="_blank"
             >beta</a>
        </h3>
      </div>
      <!--/Masthead -->


      <%call expr="self.input_container()" />


      <div class="clear"></div>


      <!-- Bar -->
      <div id="bar" class="noprint">
        <div id="spinner" class="spinner noprint" style="display: none;">
          ${h.image(request.static_url('bycycle.tripplanner:static/images/spinner.gif'), width=16, height=16, alt='Click to hide')}
        </div>

        <div id="status">
          % if status:
            ${status}
          % else:
            Welcome to the byCycle.org bicycle trip planner.
          % endif
          <span id="loading-status">Loading...</span>
        </div>

        <!-- Links -->
        <div id="links">
          ${self.links()}
        </div>
        <!-- /Links -->


        <div class="clear"></div>
      </div>
      <!-- /Bar -->


      <!-- Content -->
      <div id="content">


        <!-- Column A -->
        <div id="col-a">


          <!-- Message Pane -->
          <%
            http_status = request.response.status_int
            ## Show the message pane if there's info OR no result OR an error
            show_msg_pane = info or not result or exception or http_status > 299
            msg_pane_style = {'display': ('block' if show_msg_pane else 'none')}
            ## Show the info pane (inside the message pane) when there is NOT an error
            show_info_pane = not exception and http_status < 300
            ## Show the error pane (inside the message pane) when there IS an error
            show_error_pane = exception or http_status > 299
          %>

          <%call expr="fixed_pane(id='message_pane', classes=['display-pane'], style=msg_pane_style)">
            <div id="info_pane" ${h.hide_element(not show_info_pane)}>
              % if info:
                ${info}
              % else:
                <%include file="/news.html" />

                <hr />

                <p class="noprint">
                  Users should independently verify all information presented here. This
                  service is provided <b>AS IS</b> with <b>NO WARRANTY</b> of any kind.
                  <em>Please be careful out there.</em>
                </p>

                <p>
                  <a href="${req.registry.settings['contact_url']}"">Contact us</a><br />
                </p>

                <p class="no-bottom-margin">
                  &copy; 2012 byCycle.org
                </p>
              % endif
            </div>

            <div id="error_pane" ${h.hide_element(not show_error_pane)}>
              ${self.body()}
            </div>
          </%call>
          <!-- /Message Pane -->


          <%call expr="self.result_pane()" />


        </div>
        <!-- /Column A -->


        <!-- Column B -->
        <div id="col-b">


          <!-- Map -->
          <div id="map_pane">
            <div id="map_message" style="display: none; padding: 5px;">
              You will need to update to a recent version of Internet Explorer, Firefox, or Safari to view the map.
            </div>
          </div>
          <!-- /Map -->


        </div>
        <!-- /Column B -->


        <div class="clear"></div>
      </div>
      <!-- /Content -->


    </div>
    <!-- /Wrapper -->


    ${request.javascript_include_tag('map', 'gmap')}
    ${request.javascript_include_tag('widgets/fixed_pane', 'ui', 'regions')}
    ${self.javascript_includes()}


    <script type="text/javascript">
      //<![CDATA[
      // Set up for initialization
      byCycle.UI.beforeLoad();
      ${self.javascript()}
      //]]>
    </script>


    <%include file="_google_analytics.html" />
  </body>
</html>


<%namespace file="/widgets/fixed-pane.html" import="fixed_pane" />

<%def name="title()">Select a region</%def>

<%def name="stylesheet_links()"></%def>

<%def name="input_container(classes=[])">
  <!-- Input Container -->
  <div id="input_container" class="noprint ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Input Container -->
</%def>

<%def name="links()"></%def>

<%def name="result_pane(classes=[])">
  <!-- Result Pane -->
  <div id="result_pane" class="display-pane ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Result Pane -->
</%def>

<%def name="javascript_includes()"></%def>
<%def name="javascript()"></%def>

<%def name="errors()">
  <div class="errors">
    <h2>${error.get('title', 'Error')}</h2>
    % if hasattr(error, 'errors'):
      % for err in error['errors']:
        <p class="error">
          ${err}
        </p>
      % endfor
    % else:
      <p class="error">
        ${error['description']}
      </p>
    % endif
    <% explanation = error.get('explanation') %>
    % if explanation:
      <div class="explanation">
        <h3>What This Means</h3>
        <p>${h.literal(explanation.strip().replace('\n', '</p><p>'))}</p>
      </div>
    % endif
  </div>
</%def>


% endif ## if not wrap
