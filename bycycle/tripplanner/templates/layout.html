% if not wrap:
  ${self.body()}
% else:
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <!--[if IE]><xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"><![endif]-->

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Wyatt Baldwin, wyatt@byCycle.org">
    <meta name="description" content="byCycle.org Bicycle Trip Planner -- A web-based, interactive, bicycle trip planner (route finder) for the Portland, Oregon metro region.">

    <title>byCycle.org - Bicycle Trip Planner</title>

    <link rel="shortcut icon" href="${request.static_path('/static/favicon.ico')}">

    <link rel="stylesheet" type="text/css" href="${request.static_path('/static/bootstrap/css/bootstrap.min.css')}">
    <link rel="stylesheet" type="text/css" href="${request.static_path('/static/stylesheets/base.css')}">

    <script type="text/javascript">
      //<![CDATA[
      // Global setup
      var debug = ${str(debug).lower()};
      byCycle_prefix = '${request.script_name or "/"}';
      byCycle_staticPrefix = '${request.static_path("/static/")}';
      //]]>
    </script>

    <script src="${request.static_path('/static/javascripts/jquery.js')}"></script>
    <script src="${request.static_path('/static/bootstrap/js/bootstrap.min.js')}"></script>
    <script src="${request.static_path('/static/javascripts/bycycle.js')}"></script>
  </head>


  <body>
    <div id="container">
      <div id="top-row" class="row">
        <div id="logo" class="col-xs-4">
          <a href="${request.application_url}" title="byCycle.org Home Page">
            <div>
              <img src="${request.static_url('/static/images/logo.png')}" width="141" height="23" alt="byCycle.org">
            </div>
            <div>
              Bicycle Trip Planner
            </div>
          </a>
        </div>

        <!-- Input Forms -->
        <div class="col-xs-8">
          <ul class="nav nav-tabs">
            <li id="search-map-tab" class="active"><a href="#search-map" data-toggle="tab">Search Map</a></li>
            <li id="find-route-tab"><a href="#find-route" data-toggle="tab">Find Route</a></li>
          </ul>

          <div class="tab-content">
            <div id="search-map" class="tab-pane active">
              <form id="query_form" method="get" action="${request.resource_url('find')}"
                    class="form-inline">
                <input type="hidden" name="region" value="portlandor">

                <div class="form-group">
                  <input id="q" name="q" value="${q}" class="form-control"
                         placeholder="Address or route">
                </div>

                <div class="form-group">
                  <input type="submit" value="Search"
                         class="form-control btn-primary"
                         title="Click to search the map">
                </div>

                <span class="help-block">
                  Enter an address or intersection -OR- pick a location from the map.
                </span>
              </form>
            </div>

            <div id="find-route" class="tab-pane">
              <form id="route_form" method="get" action="${request.resource_url('find_route')}"
                    class="form-inline">
                <input type="hidden" name="region" value="portlandor">
                <input type="hidden" id="s_id" name="s_id" value="">
                <input type="hidden" id="e_id" name="e_id" value="">

                <div class="form-group">
                  <input id="s" name="s" value="${s}" class="form-control"
                         placeholder="Start address">
                  <a id="swap-s-and-e"
                     href="#swap-start-and-end"
                     title="Swap start and end addresses"
                     onclick="return false;"
                      ><span class="glyphicon glyphicon-resize-horizontal"></span></a>
                </div>

                <div class="form-group">
                  <input id="e" name="e" value="${e}" class="form-control"
                         placeholder="End address">
                </div>

                <div class="form-group">
                  <select id="pref" name="pref" class="form-control">
                    <option value="default">Route Type</option>
                    <option value="default">Normal</option>
                    <option value="safer">Safer</option>
                  </select>
                </div>

                <div class="form-group">
                  <input type="submit" value="Find Route"
                         class="form-control btn-primary"
                         title="Click to find a route">
                </div>

                <span class="help-block">
                  Enter your start and end addresses and, optionally, select a route type
                </span>
              </form>
            </div>

          </div>
        </div>
        <!-- /Input Forms -->
      </div>

      <div id="bar" class="row">
        <div id="status" class="col-xs-8">
          % if status:
            ${status}
          % else:
            Welcome to the byCycle.org bicycle trip planner
          % endif
          <span id="loading-status">Loading...</span>
        </div>

        <div class="col-xs-4">
          <span class="pull-right">
            <a id="clear-map-link" href="" title="Clear map and results">Clear Map</a>
            <a id="bookmark" href="" title="Link to last result"
               class="glyphicon glyphicon-link"></a>
          </span>
        </div>
      </div>

      <div id="main-row" class="row">
        <div id="col-a" class="col-xs-4">
          <img id="spinner" src="${request.static_path('/static/images/spinner.gif')}" width="16" height="16">

          <div id="results">
            % if info:
              ${info}
            % else:
              <%include file="/news.html"/>
            % endif
          </div>

          <div class="disclaimer">
            <p>
              <b>Disclaimer</b>: As you are riding, please keep in mind that you
              don't <i>have</i> to follow the suggested route. <i>It may not be
              safe at any given point.</i> If you see what looks like an unsafe or
              undesirable stretch in the suggested route, you can decide to walk,
              ride on the sidewalk, or go a different way.
            </p>

            <p>
              Users should independently verify all information presented here.
              This service is provided <b>AS IS</b> with <b>NO WARRANTY</b> of any
              kind. <em>Please be careful out there.</em>
            </p>

            <p>
              Â© 2004-2007,2012,2014 byCycle.org
            </p>
          </div>
        </div>

        <div id="col-b" class="col-xs-8">
          <div id="map-pane"></div>
        </div>
      </div>
    </div>

    <script src="${request.static_path('/static/OpenLayers/OpenLayers.debug.js')}"></script>
    <script src="${request.static_path('/static/javascripts/map.js')}"></script>
    <script src="${request.static_path('/static/javascripts/openlayers.js')}"></script>
    <script src="${request.static_path('/static/javascripts/ui.js')}"></script>
    <script src="${request.static_path('/static/javascripts/result.js')}"></script>
    <script src="${request.static_path('/static/javascripts/regions.js')}"></script>
    <script src="${request.static_path('/static/javascripts/query.js')}"></script>

    <script type="text/javascript">
      //<![CDATA[
      <%block name="javascript">
        byCycle.UI.beforeLoad({
          region_id: 'portlandor',
          service: '${service}',
          q: '${q}',
          http_status: ${request.response.status_int},
          jsonData: ${json or 'null' | n}
        });
      </%block>
      //]]>
    </script>

    % if not app.debug:
      <%include file="_google_analytics.html"/>
    % endif
  </body>
</html>


<%def name="errors()">
  <div class="errors">
    % if hasattr(error, 'errors'):
      % for err in error['errors']:
        <div class="alert alert-danger">
          ${err}
        </div>
      % endfor
    % else:
      <div class="alert alert-danger">
        ${error['description']}
      </div>
    % endif
    <% explanation = error.get('explanation') %>
    % if explanation:
      <div class="panel">
        <div class="panel-heading">
          <div class="panel-title">What This Means</div>
        </div>
        <div class="panel-body">
          <p>${h.literal(explanation.strip().replace('\n', '</p><p>'))}</p>
        </div>
      </div>
    % endif
  </div>
</%def>


% endif ## if not wrap
