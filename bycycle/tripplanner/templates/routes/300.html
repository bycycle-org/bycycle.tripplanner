## -*- coding: UTF-8 -*-
<%inherit file="layout.html"/>


<%!
  from urllib import unquote_plus
  from bycycle.core.model.geocode import Geocode
%>


<%namespace file="/widgets/fixed-pane.html" import="fixed_pane" />


<h2>${c.exception.title}</h2>
<h3>Select a location</h3>


<% li_class = h.cycle('ab') %>
% for i, geocodes in enumerate(c.choices):
  % if not isinstance(geocodes, Geocode):
    <%
      ul_style = '' if i == 0 else 'style="display: none;"'
      last = len(geocodes) - 1
    %>
    <ul class="result_list multi-list" ${ul_style}>
      % for j, code in enumerate(geocodes):
        <% style = '' if i < last else 'style="margin-bottom: 0;"' %>
        <li class="${li_class.next()}" ${style}>
          ${self.geocode(code, i, j)}
        </li>
      % endfor
    </ul>
  % endif
% endfor


<%def name="geocode(geocode, i, j)">
  <%
    str_addr = str(geocode.address)
    x, y = geocode.lat_long.x, geocode.lat_long.y
    html_addr = h.literal(str_addr.replace('\n', '<br />'))
    field_addr = unquote_plus(geocode.urlStr())
  %>
  <%call expr="fixed_pane(title_bar_style={'display': 'none'}, )">
    <div class="address">${html_addr}</div>
    <div class="multi-select-links">
      <a class="show-on-map-link"
         href="#show-location-on-map"
         title="Show this location on the map"
         onclick="byCycle.UI.map.setCenter({x: ${x}, y: ${y}}); return false;"
         >Show on map</a>
      |
      <a class="select-geocode-link"
         href="${url('find_geocodes', region_id=c.region.slug, q=field_addr)}#select-this-location"
         title="Select this location"
         onclick="byCycle.UI.selectRouteGeocode(this, ${i}, ${j}); return false;"
         >Select</a>
    </div>
  </%call>
</%def>
